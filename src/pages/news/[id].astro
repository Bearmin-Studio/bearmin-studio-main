---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';
import { client, type News, type MicroCMSListResponse } from '../../lib/microcms';

export async function getStaticPaths() {
  const response = await client.get<MicroCMSListResponse<News>>({
    endpoint: 'news',
    queries: { limit: 100 },
  });

  return response.contents.map((news) => ({
    params: { id: news.id },
    props: { news },
  }));
}

type Props = {
  news: News;
};

const { news } = Astro.props;

const formatDate = (dateString: string) => {
  const date = new Date(dateString);
  return new Intl.DateTimeFormat('ja-JP', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    timeZone: 'Asia/Tokyo'
  }).format(date).replace(/\//g, '.');
};
---

<BaseLayout
  title={news.title}
  description={news.excerpt || `${news.title} - Bearmin Studio | ベアミンスタジオからのお知らせ。`}
>

  <Breadcrumb items={[{ label: 'お知らせ', href: '/news' }, { label: news.title }]} />

  <div class="page-header">
    <div class="header-meta">
      <p class="article-date">{formatDate(news.date || news.publishedAt)}</p>
      {news.tags && news.tags.length > 0 && (
        <div class="news-tags">
          {news.tags.map((tag) => (
            <span class="news-tag">#{tag}</span>
          ))}
        </div>
      )}
    </div>
    <h1 class="page-title">{news.title}</h1>
  </div>

  <section class="article-section">
    <div class="article-wrap">
      {news.content && <div class="article-body" set:html={news.content} />}

      <div class="article-back">
        <a href="/news">← お知らせ一覧に戻る</a>
      </div>
    </div>
  </section>

</BaseLayout>

<style>
  .page-header {
    padding-top: 2.5rem;
  }

  @media (max-width: 768px) {
    .page-header {
      padding-top: 1.5rem;
    }
  }

  .header-meta {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.25rem;
  }

  .article-date {
    font-size: 0.875rem;
    color: var(--bear-brown);
    opacity: 0.8;
  }

  .news-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    justify-content: center;
  }

  .news-tag {
    font-size: 0.75rem;
    color: var(--moss-green);
    background: rgba(90, 111, 88, 0.1);
    padding: 0.125rem 0.5rem;
    border-radius: 4px;
  }

  /* Article */
  .article-section {
    background: var(--soft-white);
    padding: 3rem 2rem 8rem;
  }

  .article-wrap {
    max-width: 640px;
    margin: 0 auto;
  }

  .article-body {
    line-height: 2.2;
  }

  .article-body :global(p) {
    margin-bottom: 1.5rem;
    font-size: 0.9375rem;
  }

  .article-body :global(h2) {
    font-family: var(--font-accent);
    font-size: 1.25rem;
    font-weight: 500;
    color: var(--bear-brown);
    margin: 3rem 0 1.5rem;
  }

  .article-body :global(h3) {
    font-family: var(--font-accent);
    font-size: 1.125rem;
    font-weight: 500;
    color: var(--bear-brown);
    margin: 2rem 0 1rem;
  }

  .article-body :global(a) {
    color: var(--moss-green);
    text-decoration: underline;
  }

  .article-body :global(img) {
    max-width: 100%;
    height: auto;
    border-radius: 6px;
    margin: 1.5rem 0;
  }

  .article-body :global(ul),
  .article-body :global(ol) {
    padding-left: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .article-body :global(li) {
    font-size: 0.9375rem;
    line-height: 2;
    margin-bottom: 0.25rem;
  }

  .article-back {
    margin-top: 4rem;
    padding-top: 2rem;
    border-top: 1px solid rgba(107, 78, 61, 0.12);
  }

  .article-back a {
    color: var(--bear-brown);
    text-decoration: none;
    font-size: 0.875rem;
    transition: opacity 0.25s ease;
  }

  .article-back a:hover {
    opacity: 0.65;
  }

  @media (max-width: 768px) {
    .article-section {
      padding: 2rem 1.5rem 6rem;
    }
  }
</style>
